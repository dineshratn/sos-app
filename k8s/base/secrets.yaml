apiVersion: v1
kind: Secret
metadata:
  name: sos-app-secrets
  namespace: sos-app
type: Opaque
stringData:
  # PostgreSQL Credentials
  POSTGRES_USER: "postgres"
  POSTGRES_PASSWORD: "postgres"

  # JWT Secrets (CHANGE THESE IN PRODUCTION!)
  JWT_SECRET: "dev-jwt-secret-change-in-production-please-make-this-very-long-and-secure"
  JWT_REFRESH_SECRET: "dev-refresh-secret-change-in-production-also-very-long-and-secure"

  # Encryption Key for Medical Data (CHANGE IN PRODUCTION!)
  ENCRYPTION_SECRET_KEY: "dev-encryption-key-change-in-production-must-be-32-bytes-long-exactly"
  ENCRYPTION_KEY_ID: "dev-key-v1"

  # OAuth Secrets (fill in your own)
  GOOGLE_CLIENT_ID: "your-google-client-id"
  GOOGLE_CLIENT_SECRET: "your-google-client-secret"
  APPLE_CLIENT_ID: "your-apple-client-id"
  APPLE_TEAM_ID: "your-apple-team-id"
  APPLE_KEY_ID: "your-apple-key-id"
  APPLE_PRIVATE_KEY: "your-apple-private-key"

  # Email Configuration (optional)
  SMTP_HOST: "smtp.gmail.com"
  SMTP_PORT: "587"
  SMTP_USER: "your-email@gmail.com"
  SMTP_PASSWORD: "your-app-password"

  # Session Secret
  SESSION_SECRET: "dev-session-secret-change-in-production-very-long-and-random"

  # Redis Password (optional, leave empty for development)
  REDIS_PASSWORD: ""

  # MongoDB Credentials
  MONGO_USERNAME: "sos_admin"
  MONGO_PASSWORD: "sos_mongo_password_change_in_production"

  # Twilio Configuration (for SMS notifications)
  TWILIO_ACCOUNT_SID: "your-twilio-account-sid"
  TWILIO_AUTH_TOKEN: "your-twilio-auth-token"
  TWILIO_PHONE_NUMBER: "+1234567890"

  # SendGrid Configuration (for email notifications)
  SENDGRID_API_KEY: "your-sendgrid-api-key"
  SENDGRID_FROM_EMAIL: "noreply@sosapp.com"

  # Apple Push Notifications (additional config beyond OAuth)
  APNS_KEY_ID: "your-apns-key-id"
  APNS_TEAM_ID: "your-apns-team-id"
---
apiVersion: v1
kind: Secret
metadata:
  name: postgres-init-scripts
  namespace: sos-app
type: Opaque
stringData:
  init-databases.sh: |
    #!/bin/bash
    set -e

    psql -v ON_ERROR_STOP=1 --username "$POSTGRES_USER" --dbname "$POSTGRES_DB" <<-EOSQL
        -- Create databases
        CREATE DATABASE sos_auth;
        CREATE DATABASE sos_user;
        CREATE DATABASE sos_medical;
        CREATE DATABASE sos_emergency;
        CREATE DATABASE sos_location;

        -- Grant privileges
        GRANT ALL PRIVILEGES ON DATABASE sos_auth TO postgres;
        GRANT ALL PRIVILEGES ON DATABASE sos_user TO postgres;
        GRANT ALL PRIVILEGES ON DATABASE sos_medical TO postgres;
        GRANT ALL PRIVILEGES ON DATABASE sos_emergency TO postgres;
        GRANT ALL PRIVILEGES ON DATABASE sos_location TO postgres;

        -- Enable pgcrypto extension for medical database
        \c sos_medical
        CREATE EXTENSION IF NOT EXISTS pgcrypto;

        -- Enable uuid-ossp extension for all databases
        \c sos_auth
        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

        \c sos_user
        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

        \c sos_medical
        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

        \c sos_emergency
        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

        \c sos_location
        CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
        -- Note: TimescaleDB extension requires timescaledb-postgresql image
        -- CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE;
    EOSQL

    echo "Databases created successfully!"
